<!DOCTYPE html>
{% extends "teams/base.html" %}
{% load static from staticfiles %}
{% load datetime_filter %}
<html lang="en">
  <head>
    {% block title %}Practice - {{ team.abbr }}{% endblock %}
    {% block stylesheets %}
      <link rel="stylesheet" href="{% static 'teams/css/practice_create.css' %}">
    {% endblock %}
  </head>

  <body>
    {% block sidebar %}
      {{ block.super }}
    {% endblock %}

    {% block page-title %}{{ team.name }}{% endblock %}
    {% block table-title %}Practice{% endblock %}

    {% block action-buttons %}
      <!-- Delete current practice -->
      <a href="{% url 'teams:deletePractice' team.abbr practice.id %}" type="button" class="btn btn-danger btn-md pull-right" style="margin-left: 5px">
        <span class="glyphicon glyphicon-remove-circle"></span> Delete
      </a>
      <!-- Finish writing practice -->
      <a href="{% url 'teams:schedule' team.abbr week %}" type="button" class="btn btn-primary btn-md pull-right" style="margin-left: 5px">
        <span class="glyphicon glyphicon-ok-circle"></span> Finish
      </a>
      <!-- Add a set to the practice -->
      {{ block.super }}
      <!-- Open a modal containing info about writing a practice -->
      <button type="button" class="btn btn-default btn-md pull-right" style="margin-left: 5px" data-toggle="modal" data-target="#infoModal">
        <span class="glyphicon glyphicon-info-sign"></span> Info
      </button>
    {% endblock %}

    {% block modal %}
      <div id="baseModal" class="modal fade" role="dialog">
        <div class="modal-dialog">

          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <button type="button" class="close" data-dismiss="modal">&times;</button>
              <h4 class="modal-title">
                Create a Set
              </h4>
            </div>

            <div class="modal-body">
              <form id="setForm" action="#" method="post">
                {% csrf_token %}

                <!-- Set form errors -->
                {% if setForm.errors %}
                  {% for field in setForm %}
                    {% for error in field.errors %}
                      <div class="alert alert-danger" style="text-align: center">
                          <strong>{{ error|escape }}</strong>
                      </div>
                    {% endfor %}
                  {% endfor %}
                  {% for error in setForm.non_field_errors %}
                    <div class="alert alert-danger" style="text-align: center">
                        <strong>{{ error|escape }}</strong>
                    </div>
                  {% endfor %}
                {% endif %}

                <!-- Set form -->
                {% for field in setForm %}
                  {{ field }}
                {% endfor %}
                <hr>

                <!-- Rep form -->
                <table id="reps" border="0" cellpadding="0" cellspacing="0">
                    <tbody>
                        {% for form in rep_formset.forms %}
                        <tr>
                           <td>{{ form.num }}</td>
                           <td>{{ form.distance }}</td>
                           <td>{{ form.stroke }}</td>
                           <td>{{ form.rest }}</td>
                           <td>{{ form.comments }}</td>
                           <td class="remove"></td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
                {{ rep_formset.management_form }}
                <br>

                <div class="modal-footer">
                  <button type="submit" class="btn btn-md btn-primary">Submit</button>
                  <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                </div>
              </form>

            </div>

          </div>

        </div>
      </div>
    {% endblock %}

    {% block content %}
      {% for set in set_list %}
        <!-- Display sets & reps -->
        <div class="set">
          <h3>
            {{ set.order }})
            {{ set.focus|title }}
            {% if set.repeats %}
               - {{ set.repeats }}x
            {% endif %}
          </h3>

          <div class="reps">
            {% for rep in set.rep_set.all reversed %}
              {{ rep.num }} x {{ rep.distance }} {{ rep.stroke }}
              {% if rep.rest %}
                @ {{ rep.rest|format_duration }} rest
              {% endif %}
              {% if rep.comments %}
                - {{ rep.comments }}
              {% endif %}
              <br>
            {% endfor %}
          </div>

        </div>

      {% empty %}

        <!-- Display prompt if no set_list is empty -->
        <div id="first-featurette" class="row featurette empty-set">
            <h2 class="featurette-heading empty-dialogue">
              No sets yet.
              <button type="button" class="btn btn-primary btn-sm" style="margin-bottom: 3px" data-toggle="modal" data-target="#baseModal">
                <span class="glyphicon glyphicon-plus-sign"></span> Add
              </button>
              a set to get started.
            </h2>
        </div>

      {% endfor %}
    {% endblock %}

    {% block scripts %}
      <!-- Allow reps to be added or removed from set form -->
      <script type="text/javascript" src="{% static 'django-dynamic-formset/src/jquery.formset.js' %}"></script>
      <script>
        $(function() {
            $('#setForm tbody tr').formset({
              addText: 'Add Rep'
            });
        })
      </script>

      <!-- Disables 'remove' function when there is only one rep -->
      <script>
        $(function() {
          document.getElementsByClassName("remove")[0].style.display = "none";
          document.getElementsByClassName("add-row")[0].addEventListener("click", toggleRemove_onAdd);

          function toggleRemove_onAdd() {
            var row_count = $("#reps tr").length;
            if (row_count <= 2){
              document.getElementsByClassName("remove")[0].style.display = "none";
            } else {
              document.getElementsByClassName("remove")[0].style.display = "table-cell";
            }

            var delete_row = document.getElementsByClassName("delete-row")
            for (var i=0; i<delete_row.length; i++) {
              delete_row[i].addEventListener("click", toggleRemove_onDelete);
            }
          }

          function toggleRemove_onDelete() {
            var row_count = $("#reps tr").length;
            if (row_count <= 2){
              document.getElementsByClassName("remove")[0].style.display = "none";
            } else {
              document.getElementsByClassName("remove")[0].style.display = "table-cell";
            }
          }
        });
      </script>
    {% endblock %}
  </body>
</html>
